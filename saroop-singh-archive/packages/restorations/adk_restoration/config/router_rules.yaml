# ADK Restoration System - Router Rules
# Defines routing logic for different restoration workflows

restoration_modes:
  RESTORE:
    description: "Conservative restoration preserving historical accuracy"
    max_steps: 8
    quality_threshold: 70
    risk_tolerance: "low"
    
  ENHANCE:
    description: "Moderate enhancement with quality improvements"
    max_steps: 10
    quality_threshold: 75
    risk_tolerance: "medium"
    
  REIMAGINE:
    description: "Creative reimagining with modern techniques"
    max_steps: 12
    quality_threshold: 80
    risk_tolerance: "high"

routing_rules:
  # Image type based routing
  image_type:
    portrait:
      - check_face_detection
      - preserve_facial_features
      - enhance_skin_tones
    group_photo:
      - balance_exposure
      - preserve_group_composition
      - enhance_individual_faces
    document:
      - enhance_text_clarity
      - straighten_perspective
      - remove_background_noise
    landscape:
      - enhance_natural_colors
      - improve_depth_perception
      - balance_lighting
    object:
      - preserve_authenticity
      - enhance_details
      - remove_distractions

  # Quality based routing
  quality_level:
    poor:
      priority: ["defect_removal", "basic_enhancement"]
      max_temperature: 0.3
      conservative_approach: true
    fair:
      priority: ["balanced_restoration", "quality_improvement"]  
      max_temperature: 0.5
      conservative_approach: false
    good:
      priority: ["refinement", "creative_enhancement"]
      max_temperature: 0.7
      conservative_approach: false

  # Defect based routing
  defect_types:
    critical:
      - "tear"
      - "missing_part"
      - "water_damage"
      - "mold"
    moderate:
      - "scratch" 
      - "fold"
      - "stain"
    minor:
      - "dust"
      - "fade"

step_definitions:
  defect_removal:
    prompt_template: "Carefully remove {defect_type} defects from this vintage photograph while preserving the original character and historical authenticity. Focus on {location} areas."
    temperature_range: [0.2, 0.4]
    expected_outcome: "Clean image with defects removed"
    
  enhance_sharpness:
    prompt_template: "Enhance the sharpness and clarity of this vintage photograph, bringing out fine details while maintaining the natural grain and texture of the original."
    temperature_range: [0.3, 0.5]
    expected_outcome: "Sharper image with enhanced details"
    
  adjust_brightness:
    prompt_template: "Adjust the brightness and exposure of this photograph to reveal hidden details in shadows and highlights while preserving the original mood and atmosphere."
    temperature_range: [0.2, 0.4]
    expected_outcome: "Properly exposed image"
    
  adjust_contrast:
    prompt_template: "Improve the contrast and tonal range of this vintage photograph to enhance visual impact while maintaining historical authenticity."
    temperature_range: [0.3, 0.5]
    expected_outcome: "Enhanced contrast and tonal range"
    
  colorize:
    prompt_template: "Add historically accurate colors to this black and white vintage photograph from the {era} era, considering the {cultural_context} and typical clothing/environmental colors of that period."
    temperature_range: [0.5, 0.7]
    expected_outcome: "Naturally colorized image"
    
  reconstruct_missing:
    prompt_template: "Intelligently reconstruct missing or severely damaged portions of this vintage photograph using contextual clues and historical accuracy as guides."
    temperature_range: [0.4, 0.6]
    expected_outcome: "Reconstructed missing areas"
    
  creative_enhancement:
    prompt_template: "Apply creative enhancement techniques to transform this vintage photograph into a modern, high-quality image while respecting its historical significance and original composition."
    temperature_range: [0.6, 0.8]
    expected_outcome: "Creatively enhanced image"

quality_gates:
  step_validation:
    min_improvement_score: 5
    max_quality_loss: 10
    preservation_threshold: 80
    
  final_validation:
    min_overall_score: 70
    required_criteria:
      preservation_of_original: 75
      defect_removal: 70
      enhancement_quality: 65
      naturalness: 70
      technical_quality: 65

retry_policies:
  max_attempts: 3
  temperature_adjustment:
    strategy: "decrease"
    step_size: 0.1
    min_temperature: 0.1
  
  failure_escalation:
    level_1: "adjust_parameters"
    level_2: "simplify_approach" 
    level_3: "manual_review"